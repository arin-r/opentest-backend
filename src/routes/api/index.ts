import express from "express";
import User from "../../models/User";
import connectMongo from "../../helpers/connectMongo";
import { IGetUserAuthInfoRequest } from "../../interfaces/IGetUserAuthInfoRequest";
import Test from "../../models/Test";
import Question from "../../models/Question";
import generateRandomHex from "../../helpers/getHexId";
import TestSession from "../../models/TestSession";
const tests = require("./tests/index")

const router = express.Router();

router.use("/tests", tests)

router.get("/me", async (req: IGetUserAuthInfoRequest, res) => {
  if (req.isAuthenticated()) {
    await connectMongo();
    // const user: Express.User & {email: string} = req.user;
    const userInformation = await User.findOne({
      email: req.user.email,
    });
    if (!userInformation) {
      throw new Error("User is logged in but user does not exist in DB. Impossible case");
    }
    console.log(userInformation);
    res.status(200).json({
      isLoggedIn: true,
      userStatus: userInformation.status,
    });
  } else {
    res.status(200).json({
      isLoggedIn: false,
      userStatus: "guest",
    });
  }
});


module.exports = router;
