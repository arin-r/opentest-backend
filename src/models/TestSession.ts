
import mongoose, { Schema, model, models, Model } from "mongoose";
import { TypeOfExpression } from "typescript";


type TestSesionInfo = {
  user: mongoose.Types.ObjectId; // points to user._id
  sessionOf: mongoose.Types.ObjectId; // points to test._id
  attempts: AttemptType[]; //[{question._id, answer: string}]
  startTime: Date;
  endTime: Date;
  score: number;
};

type AttemptType = {
  questionId: mongoose.Types.ObjectId,
  chosenOptionId: string | null,
  markedForReview: boolean,
  seen: boolean
}

const attemptSchema = new Schema<AttemptType>( {
    questionId: {
      type: Schema.Types.ObjectId,
      required: true
    },
    chosenOptionId: {
      type: String,
      default: null,
    },
    markedForReview: {
      type: Boolean,
      required: true
    },
    seen: {
      type: Boolean,
      required: true
    },
  },
  {_id: false}
)

const testSessionSchema = new Schema<TestSesionInfo>({
  user: {
    type: Schema.Types.ObjectId,
    ref: "User",
    required: true
  },
  sessionOf: {
    type: Schema.Types.ObjectId,
    ref: "Test",
    required: true
  },
  attempts: {
    type: [attemptSchema],
    required: true
  },
  startTime: {
    type: Date,
    required: true
  },
  endTime: {
    type: Date,
    required: true,
  },
  score: {
    type: Number,
    required: false,
  }
});

export default (models.TestSession as Model<TestSesionInfo>) || model("TestSession", testSessionSchema);
