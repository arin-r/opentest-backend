import { Schema, model, models, Model } from "mongoose";

type QuestionType = "mcq" | "numerical";

type Option = {
  statement: string;
  hexId: string;
};

type QuestionInfo = {
  statement: string;
  hexId: string;
  questionType: QuestionType;
  options?: Option[];
  correctAnswer: string; // hexId or a number - will have to convert string to number if option-type is numerical
  randomValue: string;
};

const optionSchema = new Schema(
  {
    statement: { type: String, required: true },
    hexId: { type: String, required: true },
  },
  { _id: false }
);

const questionSchema = new Schema<QuestionInfo>({
  statement: {
    type: String,
    required: true,
  },
  hexId: {
    type: String,
    required: true,
    unique: true,
  },
  questionType: {
    type: String,
    required: true,
  },
  options: {
    type: [optionSchema],
    required: false,
    default: undefined,
    set: (v: any) => {
      if (!v || v.length === 0) {
        return undefined;
      }
      return v;
    },
  },
  correctAnswer: {
    type: String,
    required: true,
  },
});

export default (models.Question as Model<QuestionInfo>) || model("Question", questionSchema);
